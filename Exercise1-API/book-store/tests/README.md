# TESTING STRATEGY

## Overview

The testing strategy outlined below is designed to develop comprehensive and robust unit tests for the bookstore_api RESTful API.
This system includes features for creating, updating, retrieving, and deleting book records from bookstore_api.
The testing process includes verifications for the HTTP protocol, CRUD operations, and various testing strategies such as boundary conditions, data-driven testing, and validation of responses.

## Testing structure
Testing scripts can be found in 'tests' directory. There we have this file tree:

│   CREATE_test.py
│   DATA_test.py
│   DELETE_test.py
│   README.md
│   READ_test.py
│   UPDATE_test.py
│
├───samples
│
├───test_utils
│   │   constants.py
│   │   json_utils.py
│   │   random_book.py
│   │   utils.py

## Testing scripts and files

In the first level, we can find the following CRUD operations test scripts:
1. **CREATE_test.py**. Includes test cases for CREATE operation in bookstore_api. It includes various test scenarios with different data inputs and expected outcomes. Test data is organized into a list of dictionaries, with each dictionary representing a test case. Each test case includes books to create, the expected API response, and the expected HTTP status code.
2. **READ_test.py**. This file contains test cases for retrieving books from bookstore_api. The tests include retrieving all books and retrieving a single book.
3. **UPDATE_test.py**. Includes test cases for UPDATE operation in bookstore_api. It includes various test scenarios with different data inputs and expected outcomes. Test data is organized into a list of dictionaries, with each dictionary representing a test case. Each test case includes books to create, book ID to update, update data, the expected API response, and the expected HTTP status code.
4. **DELETE_test.py**. Includes test cases for DELETE operation in bookstore_api. It includes scenarios for deleting single and multiple books. Test data is provided to cover various deletion scenarios.
With this scripts, we cover all good and bad cases and boundary scenarios of CRUD operations.
Tests are parametrized with different sets of data meant to cover all cases. Every set of data has its information, test case description and expected result, so it is easier to read the code

Also we can find a script for the data-driven tests:
1. **DATA_test.py**. This script contains a test case for different operations in bookstore_api. It includes a comprehensive test scenario with different steps such as creating, retrieving, updating, and deleting the book. Test data is generated RANDOMLY to ensure a variety of inputs.  The random books are generated by random_book, using OPEN LIBRARY API.
With this script, it is intended to cover all possible use cases and operations. Therefore a big sample of random books are created, updated, retrieved and deleted, in order to find errors in edge cases that we would not find otherwise.

In the **samples** level, there are a total of 65 files working to be the constant input data and expected output for CRUD, boundary and data-driven tests.

In the **test_utils** level, we can find scripts that asist the first level scripts by:
1. **constants.py**. Gives the path routes to the files present in samples.
2. **json_utils.py**. Gives two methods that allow to compare json files.
3. **random_book.py**. It is the script that provides random books from OPEN LIBRARY API to DATA_test script. random_book also contains a isbn and a price generator, since OPEN LIBRARY API don't always provide them.
4. **utils.py**.  This file contains utility functions for performing CRUD operations on bookstore_api, as well as methods for parsing API responses and preprocessing/postprocessing tasks.

## Changes to API
Some changes have been applied also to the API in order to give more restriction to the input data and be able to add more bad cases test:
- When creating or updating a book, the date is restricted to:
	- Not allow to be in the future
	- Not allow to be in a wrong date format

- When creating or updating a book, the title is restricted to:
	- Not allow to be empty

- When creating or updating a book, the isbn is restricted:
	- To be a number between with length 10 (isbn-10) or 13 (isbn-13)

- When creating or updating a book, the Price is restricted:
	- To be a positive number

# Conclusion
Overall, this testing strategy intends to be well-structured and to provide a comprehensive approach to testing the bookstore_api RESTful API. It combines a variety of testing techniques, including data-driven testing, random data generation, and boundary testing, to ensure that the application functions correctly under diverse conditions and scenarios.

# HOW TO RUN TESTS
From testing-challenge root

## Requirements

- python
- pytest
- poetry
- jsondiff
- flask

## Setup poetry

Install with poetry:

```shell script
poetry shell
poetry install 
```

## Run the API

From the poetry shell:

```bash
python Exercise1-API\book-store\api\bookstore_api.py

```

Your API will start running at **`http://127.0.0.1:5000/`**.

## Run Tests

Go to Exercise1-API\book-store\tests

```bash
pytest
```

This should execute all test cases in book-store\tests. It is important to be in Exercise1-API\book-store\tests to execute the pytest command.

## Test results

pytest will provide a test execution summary in the terminal

# TEST AUTOMATION 
To automate the execution of this test strategy when code is pushed to the repository, a file python-ci_exercise_1.yml has been added to .github/workflows in order to define a workflow in GitHub. 
This workflow triggers on every push to the main branch. It checks out the code, sets up Python, installs project dependencies, and runs tests using pytest.
After the workflow completes, you can view test results and logs directly in the Actions tab in GitHub. If there are any test failures, you'll be notified.

A html report gets uploaded as an artifact accessible in GitHub